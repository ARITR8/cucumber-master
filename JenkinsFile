
stage 'Init'



node ('xx-node') {
                    
                

stage ('Checkout') {
          checkout scm
      }
      
      stage ('Maven Build') {
                        
                  //   echo $M2_HOME
					//	echo $PATH
                            
                         bat 'mvn test'
                     //   sh 'mvn test'
                            
                             }
                       
			
          stage('Cucumber Reports') {
        
		
			    cucumber buildStatus: 'UNSTABLE',
			    
			    fileIncludePattern: '**/cucumber.json',
			    jsonReportDirectory: 'target'
			

                              
        
			
                          }
                          
               stage('Html report') {
         
            publishHTML target: [
                reportName: 'Test',
                reportDir: 'target/cucumber',
                reportFiles: 'index.html', 
             
                keepAll: true,
                alwaysLinkToLastBuild: true,
                allowMissing: false
            ]               
              
                 }
                 
 stage ('Send Email') {
 //DATE_TAG = java.time.LocalDate.now()
        echo "Mail Stage";
        archiveArtifacts artifacts: "target/cucumber/index.html"
        DATE_TAG = java.time.LocalDate.now()
        DATETIME_TAG = String.format('%tF %<tH:%<tM', java.time.LocalDateTime.now())

         mail to: "aritradas75@gmail.com",
        // cc: 'manager@domainxxx.com', charset: 'UTF-8', 
         from: 'aritradas75@gmail.com', mimeType: 'text/html', replyTo: '', 
         bcc: '',
         subject: "Test Execution Report", // -> ${env.JOB_NAME}",
         body: "Dear All, <br> <br> Plese find the test report executed on: ${DATETIME_TAG}  <br>Project: ${env.JOB_NAME} <br>Build Number: ${env.BUILD_NUMBER}" + 
         " <br> URL de build: ${env.BUILD_URL} "  ;
         emailext attachmentsPattern: "target/cucumber/index.html"
         
    } 
    
    
    
    }       
                    
                
                    

